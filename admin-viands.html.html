<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Panel Admin – Viands Sur</title>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,700;12..96,800&family=Manrope:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{--accent:#F47B20;--black:#0A0A0A;--white:#FAFAF8;--gray-100:#F2F2F0;--gray-500:#6B6B6B;--gray-700:#2E2E2E;}
body{font-family:'Manrope',sans-serif;background:var(--gray-100);color:var(--black);min-height:100vh;}

/* LOGIN */
#login-screen{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:2rem;}
.login-box{background:white;border-radius:12px;padding:3rem;width:100%;max-width:400px;box-shadow:0 4px 30px rgba(0,0,0,0.08);}
.login-box h1{font-family:'Bricolage Grotesque',sans-serif;font-size:1.6rem;font-weight:800;color:var(--black);margin-bottom:0.4rem;}
.login-box p{font-size:0.85rem;color:var(--gray-500);margin-bottom:2rem;}
.login-box label{font-size:0.7rem;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--gray-500);display:block;margin-bottom:0.4rem;}
.login-box input{width:100%;border:1.5px solid rgba(0,0,0,0.12);border-radius:6px;padding:0.9rem 1.1rem;font-family:'Manrope',sans-serif;font-size:0.9rem;outline:none;transition:border-color 0.2s;margin-bottom:1rem;}
.login-box input:focus{border-color:var(--accent);}
.login-btn{width:100%;background:var(--accent);color:white;border:none;padding:1rem;border-radius:6px;font-family:'Bricolage Grotesque',sans-serif;font-weight:700;font-size:0.85rem;letter-spacing:0.06em;text-transform:uppercase;cursor:pointer;transition:background 0.2s;}
.login-btn:hover{background:#D4630A;}
.login-error{display:none;background:rgba(220,50,50,0.08);border:1px solid rgba(220,50,50,0.3);border-radius:6px;padding:0.7rem 1rem;font-size:0.82rem;color:#C0392B;margin-top:0.8rem;}

/* ADMIN */
#admin-screen{display:none;min-height:100vh;}
.admin-nav{background:var(--black);padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between;}
.admin-nav img{height:38px;}
.admin-nav span{font-size:0.75rem;color:rgba(255,255,255,0.4);}
.logout-btn{background:transparent;color:rgba(255,255,255,0.5);border:1px solid rgba(255,255,255,0.15);padding:0.4rem 1rem;border-radius:6px;font-family:'Manrope',sans-serif;font-size:0.75rem;cursor:pointer;transition:color 0.2s,border-color 0.2s;}
.logout-btn:hover{color:white;border-color:rgba(255,255,255,0.4);}
.admin-body{max-width:900px;margin:0 auto;padding:3rem 2rem;}
.admin-header{margin-bottom:2.5rem;}
.admin-header h2{font-family:'Bricolage Grotesque',sans-serif;font-size:1.8rem;font-weight:800;color:var(--black);}
.admin-header p{font-size:0.88rem;color:var(--gray-500);margin-top:0.4rem;}
.week-box{background:white;border-radius:10px;padding:1.5rem;margin-bottom:2rem;display:flex;align-items:center;gap:1rem;flex-wrap:wrap;}
.week-box label{font-size:0.72rem;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--gray-500);}
.week-box input{border:1.5px solid rgba(0,0,0,0.12);border-radius:6px;padding:0.6rem 1rem;font-family:'Manrope',sans-serif;font-size:0.88rem;outline:none;flex:1;min-width:180px;}
.week-box input:focus{border-color:var(--accent);}
.dias-grid{display:flex;flex-direction:column;gap:1rem;}
.dia-card{background:white;border-radius:10px;overflow:hidden;}
.dia-title{background:var(--black);color:white;padding:1rem 1.5rem;font-family:'Bricolage Grotesque',sans-serif;font-weight:800;font-size:0.95rem;letter-spacing:0.05em;text-transform:uppercase;}
.dia-platos{padding:1rem 1.5rem;display:flex;flex-direction:column;gap:0.8rem;}
.plato-edit{display:grid;grid-template-columns:1fr 1fr auto;gap:0.6rem;align-items:center;padding:0.8rem;background:var(--gray-100);border-radius:8px;}
.plato-edit input{border:1.5px solid rgba(0,0,0,0.1);border-radius:6px;padding:0.5rem 0.8rem;font-family:'Manrope',sans-serif;font-size:0.82rem;outline:none;width:100%;}
.plato-edit input:focus{border-color:var(--accent);}
.plato-edit select{border:1.5px solid rgba(0,0,0,0.1);border-radius:6px;padding:0.5rem 0.8rem;font-family:'Manrope',sans-serif;font-size:0.8rem;outline:none;background:white;}
.plato-edit select:focus{border-color:var(--accent);}
.del-btn{background:rgba(220,50,50,0.08);color:#C0392B;border:1px solid rgba(220,50,50,0.2);width:32px;height:32px;border-radius:6px;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background 0.2s;}
.del-btn:hover{background:rgba(220,50,50,0.15);}
.add-plato-btn{margin:0 1.5rem 1rem;background:transparent;border:1.5px dashed rgba(0,0,0,0.15);border-radius:8px;padding:0.6rem;width:calc(100% - 3rem);font-family:'Manrope',sans-serif;font-size:0.8rem;color:var(--gray-500);cursor:pointer;transition:border-color 0.2s,color 0.2s;}
.add-plato-btn:hover{border-color:var(--accent);color:var(--accent);}
.save-bar{position:sticky;bottom:0;background:white;border-top:1px solid rgba(0,0,0,0.08);padding:1.2rem 2rem;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:1rem;}
.save-bar p{font-size:0.85rem;color:var(--gray-500);}
.save-btn{background:var(--accent);color:white;border:none;padding:0.9rem 2.5rem;border-radius:6px;font-family:'Bricolage Grotesque',sans-serif;font-weight:700;font-size:0.85rem;letter-spacing:0.06em;text-transform:uppercase;cursor:pointer;transition:background 0.2s;}
.save-btn:hover{background:#D4630A;}
.save-msg{font-size:0.82rem;color:#4A9E5C;display:none;font-weight:600;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <h1>Panel Admin</h1>
    <p>Viands Sur — Gestión de menú semanal</p>
    <label>Contraseña</label>
    <input type="password" id="pwd-input" placeholder="Ingresá tu contraseña" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">Ingresar</button>
    <div class="login-error" id="login-error">Contraseña incorrecta. Intentá de nuevo.</div>
  </div>
</div>

<!-- ADMIN -->
<div id="admin-screen">
  <div class="admin-nav">
    <span style="color:white;font-family:'Bricolage Grotesque',sans-serif;font-weight:800;font-size:1rem;">VIANDS SUR · ADMIN</span>
    <div style="display:flex;align-items:center;gap:1rem;">
      <span>Panel de menú</span>
      <button class="logout-btn" onclick="doLogout()">Cerrar sesión</button>
    </div>
  </div>

  <div class="admin-body">
    <div class="admin-header">
      <h2>Editor de menú semanal</h2>
      <p>Editá los platos de cada día y guardá. Los cambios se reflejan en la web al instante.</p>
    </div>

    <div class="week-box">
      <label>Semana del:</label>
      <input type="text" id="week-label" placeholder="Ej: 24/2 al 28/2">
    </div>

    <div class="dias-grid" id="dias-grid"></div>
  </div>

  <div class="save-bar">
    <p>Los cambios se guardan en la nube y se ven en la web al instante.</p>
    <div style="display:flex;align-items:center;gap:1rem;">
      <span class="save-msg" id="save-msg">✓ Menú guardado correctamente</span>
      <button class="save-btn" onclick="saveMenu()">Guardar menú</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey:"AIzaSyBr9WrV9k2yFCeO9Y7BmR_YqY6OgHvh4xA",
  authDomain:"viands-sur.firebaseapp.com",
  databaseURL:"https://viands-sur-default-rtdb.firebaseio.com",
  projectId:"viands-sur",
  storageBucket:"viands-sur.firebasestorage.app",
  messagingSenderId:"309846503415",
  appId:"1:309846503415:web:54d7f027bd6ca7354b48f2"
});
</script>

<script>
let db;
try {
  db = firebase.database();
} catch(e) {
  console.error('Firebase error:', e);
}
const PASSWORD = 'Cepreco';
const DIAS = ['Lunes','Martes','Miércoles','Jueves','Viernes'];
const TAGS = ['Clásico','Dieta','Fit','Ensalada','Especial','Vegano'];
let menuData = {};

function doLogin(){
  const val = document.getElementById('pwd-input').value;
  if(val === PASSWORD){
    document.getElementById('login-screen').style.display='none';
    document.getElementById('admin-screen').style.display='block';
    if(db) loadMenu(); else alert('Error de conexión con la base de datos. Recargá la página.');
  } else {
    document.getElementById('login-error').style.display='block';
  }
}

function doLogout(){
  document.getElementById('admin-screen').style.display='none';
  document.getElementById('login-screen').style.display='flex';
  document.getElementById('pwd-input').value='';
}

function loadMenu(){
  db.ref('menu').once('value').then(snap => {
    const data = snap.val() || {};
    menuData = data;
    document.getElementById('week-label').value = data.weekLabel || '';
    renderEditor(data);
  });
}

function renderEditor(data){
  const grid = document.getElementById('dias-grid');
  grid.innerHTML = '';
  DIAS.forEach(dia => {
    const platos = (data[dia] && data[dia].platos) || [{nombre:'',descripcion:'',tag:'Clásico'}];
    const card = document.createElement('div');
    card.className = 'dia-card';
    card.innerHTML = `<div class="dia-title">${dia}</div><div class="dia-platos" id="platos-${dia}"></div>
      <button class="add-plato-btn" onclick="addPlato('${dia}')">+ Agregar plato</button>`;
    grid.appendChild(card);
    const container = document.getElementById(`platos-${dia}`);
    platos.forEach((p,i) => addPlatoRow(container, dia, p, i));
  });
}

function addPlatoRow(container, dia, plato, idx){
  const row = document.createElement('div');
  row.className = 'plato-edit';
  row.dataset.dia = dia;
  const tagsOpts = TAGS.map(t => `<option ${t===plato.tag?'selected':''}>${t}</option>`).join('');
  row.innerHTML = `
    <input type="text" placeholder="Nombre del plato" value="${plato.nombre||''}" onchange="updateData()">
    <input type="text" placeholder="Descripción" value="${plato.descripcion||''}" onchange="updateData()">
    <select onchange="updateData()">${tagsOpts}</select>
    <button class="del-btn" onclick="this.closest('.plato-edit').remove();updateData()">✕</button>`;
  container.appendChild(row);
}

function addPlato(dia){
  const container = document.getElementById(`platos-${dia}`);
  addPlatoRow(container, dia, {nombre:'',descripcion:'',tag:'Clásico'}, container.children.length);
}

function updateData(){
  // just triggers on change, actual read happens on save
}

function saveMenu(){
  const newData = { weekLabel: document.getElementById('week-label').value };
  DIAS.forEach(dia => {
    const rows = document.querySelectorAll(`#platos-${dia} .plato-edit`);
    const platos = [];
    rows.forEach(row => {
      const inputs = row.querySelectorAll('input');
      const sel = row.querySelector('select');
      platos.push({ nombre: inputs[0].value, descripcion: inputs[1].value, tag: sel.value });
    });
    newData[dia] = { platos };
  });
  db.ref('menu').set(newData).then(() => {
    const msg = document.getElementById('save-msg');
    msg.style.display='inline';
    setTimeout(()=>msg.style.display='none', 3000);
  });
}
</script>
</body>
</html>